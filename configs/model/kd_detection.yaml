_target_: src.models.detection_kd_module.DetectionKDModule
optimizer:
  _target_: torch.optim.AdamW
  _partial_: true
  lr: 0.0001
  weight_decay: 0.0

scheduler:
  _target_: torch.optim.lr_scheduler.StepLR
  _partial_: true
  step_size: 30
  gamma: 0.5

use_teacher: true
warmup_epochs: 5
det_ramp_epochs: 30
kd_weight_scale: 0.7

use_det_teacher: true

# detection teacher for box-level distillation
det_teacher:
  _target_: src.models.components.detection.DetectionTeacher
  arch: fasterrcnn_resnet50_fpn
  num_classes: ${data.attributes.class_num}
  add_background: true
  weights: DEFAULT
  weights_backbone: null
  ckpt_path: null
  label_offset: ${data.label_offset}
  image_size: null
  box_format: null

# detection KD settings
det_kd_decay_epochs: 60
det_kd_weight_scale: 1.0
det_kd_box_weight: 1.0
det_kd_score_weight: 0.5
det_kd_iou_thresh: 0.5
det_kd_score_thresh: 0.02
det_kd_topk: 100
det_kd_match_labels: true

net:
  _target_: src.models.components.detection.DetectionTeacherStudent
  teacher:
    arch: convnext_xxlarge
    pretrained: laion2b_s34b_b82k_augreg_soup
  data_attributes: ${data.attributes}
  student:
    arch: ssdlite320_mobilenet_v3_large
    add_background: true
    weights: DEFAULT
    weights_backbone: null
    label_offset: ${data.label_offset}
    image_size: null
    box_format: null

kd_criterion:
  _target_: src.models.components.criterion.KDCriterion
  img_criterion:
    _target_: torch.nn.L1Loss
  nlp_criterion:
    _target_: torch.nn.KLDivLoss
  temperature: 2.0
  class_num: ${data.attributes.class_num}

compile: false
